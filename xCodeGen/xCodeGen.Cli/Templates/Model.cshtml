@using System.Linq
@using xCodeGen.Abstractions.Metadata
@model xCodeGen.Abstractions.Metadata.ClassMetadata
@{
    var className = Model.ClassName;

    string metaHash = "N/A"; // 统一获取由引擎注入的稳定哈希
    if (Model.GenerateCodeSettings != null && Model.GenerateCodeSettings.ContainsKey("MetadataHash"))
    {
        metaHash = Model.GenerateCodeSettings["MetadataHash"]?.ToString() ?? "N/A";
    }
    var timestamp = DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss");
}
// <auto-generated>
// 此文件由 xCodeGen 自动生成，请勿手动修改。
// @@[xCodeGen.Hash: @metaHash]
// 模型: @Model.ClassName (@Model.FullName)
// 生成时间: @timestamp
// </auto-generated>

using System;
using System.ComponentModel.DataAnnotations;
using TKW.Framework.Domain.Interception.Filters;

namespace @Model.Namespace;

public partial class @className
{
    /// <summary>
    /// 自动生成的领域一致性验证
    /// </summary>
    protected void ValidateCore()
    {
@foreach (var p in Model.Properties)
{
    var lenAttr = p.Attributes.FirstOrDefault(a => a.TypeFullName.Contains("StringLengthAttribute") 
                  || a.TypeFullName.Contains("MaxLengthAttribute") 
                  || a.TypeFullName.Contains("ColumnAttribute"));

    if (lenAttr != null && lenAttr.Properties.ContainsKey("StringLength"))
    {
        var max = lenAttr.Properties["StringLength"];
        var fieldSummary = string.IsNullOrWhiteSpace(p.Summary) ? p.Name : p.Summary;
        @:        if (this.@(p.Name)?.Length > @max) 
        @:            throw new ValidationException("@Raw(fieldSummary) 长度超限 (最大 @max)");
    }
}
        OnCustomValidate();
    }

    partial void OnCustomValidate();
}