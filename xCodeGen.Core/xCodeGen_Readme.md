# xCodeGen 设计与发展规划

---

## 一、设计思路

xCodeGen 是一个**元数据驱动的通用代码生成工具**，以高度中性化、可扩展为核心目标。其设计理念是：

- 彻底剥离业务逻辑，仅关注代码结构和元数据。
- 通过 Roslyn API 精确提取类、方法、参数等元数据。
- 结合灵活的模板系统（RazorLight），支持任意类型代码产物生成。
- 以命令行工具为主，便于集成到 CI/CD、构建流程、脚本等。
- 配置驱动，支持多项目、多语言、插件式扩展。

---

## 二、系统架构

```
xCodeGen/
├─ xCodeGen.Abstractions/      # 元数据模型与特性定义
│   ├─ Attributes/             # 代码生成标记特性
│   └─ Metadata/               # 类/方法/参数元数据结构
├─ xCodeGen.Core/              # 核心引擎
│   ├─ Engine/                 # 生成流程协调
│   ├─ Extraction/             # Roslyn元数据提取
│   ├─ Debugging/              # 调试与日志
│   └─ Templates/              # 模板执行器
├─ xCodeGen.Utilities/         # 通用工具类（命名、类型、验证等）
├─ xCodeGen.Configuration/     # 配置系统
├─ xCodeGen.Templates/         # 模板管理
└─ xCodeGen.Cli/               # 命令行入口（未来可扩展）
```

---

## 三、技术原理

### 1. 元数据提取

- 基于 Roslyn 编译器平台，分析 C# 项目结构。
- 提取所有标记了 `[GenerateArtifact]` 的类和方法。
- 获取方法参数、类型、特性、集合、可空性等详细信息。
- 支持跨项目、跨文件分析。

### 2. 模板系统

- 使用 RazorLight 作为模板引擎。
- 支持 Razor 语法，灵活定义代码生成规则。
- 模板可调用工具类（命名转换、类型处理、验证规则等）。
- 支持多模板、多产物类型映射。

### 3. 配置驱动

- 通过 JSON 配置文件管理目标项目、输出目录、模板映射、工具类启用等。
- 支持多产物类型、多模板、多输出目录。
- 可扩展插件式工具类。

### 4. 调试与日志

- 详细记录元数据提取、生成过程、错误信息。
- 支持调试目录、分阶段日志输出。

### 5. 命令行工具

- 提供 CLI 入口，支持参数化执行、集成到自动化流程。
- 未来可扩展为 GUI/IDE 插件。

---

## 四、主要功能

1. **元数据驱动代码生成**
   
   - 支持 DTO、Validator、Query、Service 等任意类型产物。
   - 产物类型与模板完全解耦，灵活扩展。

2. **模板系统**
   
   - 支持自定义 Razor 模板。
   - 模板可调用命名、类型、验证等工具类。

3. **配置化管理**
   
   - 产物类型、模板路径、输出目录、工具类均可配置。
   - 支持多项目、多产物类型。

4. **调试与日志**
   
   - 生成过程详细日志，便于问题排查。
   - 元数据、生成结果、错误均有独立日志。

5. **命令行集成**
   
   - 支持参数化执行、批量生成、自动化集成。

6. **扩展性**
   
   - 工具类插件化，模板可扩展。
   - 支持未来多语言、多项目、多产物类型。

---

## 五、未来版本计划

### v1.x（当前）

- 元数据驱动代码生成（C# Roslyn）
- RazorLight 模板系统
- 命令行工具、配置化管理
- 调试与日志输出

### v2.x（规划）

- **增量生成与智能检测**：只生成变更部分，提升性能。
- **多语言支持**：支持 TypeScript、Java、Go 等代码生成。
- **插件式工具类**：支持自定义工具类扩展。
- **IDE 插件/GUI**：VS/VSCode 插件，提升开发体验。
- **模板热加载**：模板变更自动刷新。
- **产物管理**：支持清理、覆盖策略、产物追踪。
- **更丰富的 CLI 参数**：如预览、过滤、DryRun、批量等。
- **性能优化**：提升大项目/多模板下的生成速度。
- **更强的元数据分析**：支持继承、接口、泛型、注释等。

### v3.x（远期）

- **源生成器模式支持**：可选 Roslyn Source Generator 自动生成。
- **跨语言模板引擎**：支持 Scriban、Handlebars 等。
- **云端/服务化生成**：支持远程代码生成、API 集成。
- **团队协作与模板共享**：模板市场、团队协作。

---

## 六、总结

xCodeGen 致力于打造一个**高扩展性、强元数据驱动、模板灵活、易于集成**的通用代码生成平台。当前以命令行工具为主，未来将支持多语言、多模式、插件化、智能化等高级功能。

---

# 备忘

## 区别说明

| 方式    | 命令行工具（如 xCodeGen）   | Roslyn 源生成器（Source Generator） |
| ----- | ------------------- | ----------------------------- |
| 触发时机  | 手动运行命令，生成代码文件       | 编译时自动生成，集成到 IDE/编译流程          |
| 产物管理  | 生成物落地为物理文件，需手动管理    | 产物为虚拟代码，自动参与编译，无需手动管理         |
| 灵活性   | 可自定义流程、模板、输出目录等     | 受限于 Roslyn API，主要用于辅助代码生成     |
| 集成难度  | 易于集成到 CI/CD、脚本、构建流程 | 需理解 Roslyn API，调试复杂           |
| 适用场景  | 复杂代码生成、跨项目、跨语言、批量生成 | 编译期自动生成、简化样板代码                |
| 调试/扩展 | 可详细日志、断点调试、易于扩展     | 调试受限，扩展性依赖 Roslyn             |

## 推荐建议

- **命令行工具方式**  
  适合需要灵活控制生成流程、支持多项目/多语言、复杂模板、可落地物理文件的场景。易于集成到 CI/CD、构建脚本。

- **源生成器方式**  
  适合自动生成样板代码、编译期参与、无需落地文件、与 IDE 深度集成的场景。适合轻量级、辅助型代码生成。

> 如果你的需求是通用、可扩展、支持多种模板和复杂生成逻辑，推荐继续采用 **命令行工具方式**。

---

## xCodeGen 命令行方式的改进建议

1. **模板热加载与调试**  
   支持模板变更自动刷新，无需重启工具。

2. **增量生成 / 智能检测**  
   只生成变更部分，避免全量覆盖。

3. **多语言 / 多项目支持**  
   支持跨项目、跨语言的元数据提取和生成。

4. **更丰富的 CLI 参数**  
   如指定目标、过滤、预览、DryRun 等。

5. **生成物管理**  
   支持清理、覆盖策略、产物追踪。

6. **IDE 插件 / 集成**  
   可选 VS/VSCode 插件，提升开发体验。

7. **错误提示与日志**  
   更详细的错误定位和生成日志。

8. **配置与扩展性**  
   支持插件式扩展、配置热更新。

9. **性能优化**  
   提升大项目 / 多模板下的生成速度。
